
<!-- Index Layout Start -->

<!DOCTYPE html>
<html lang="en">

  
<!-- HEAD Start -->

<head>
  


  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Datastory for ADA course 2017">
  <meta name="author" content="Mohammad Yaghini, Sina Fakheri and Leonardo Wirz">
  <meta name="keywords" content="awesome, absolutly need it">
  <link rel="canonical" href="/RTStory/">
  <title>{ RTStory }</title>

  <!-- Bootstrap Core CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

  <!-- Custom CSS -->
  <link href="/RTStory/css/grayscale.css" rel="stylesheet">
  
  <link href="/RTStory/css/timeline.css" rel="stylesheet">
  


  <!-- Custom Javascript-->
  <!-- Custom Mohammad-->

  <script src="https://d3js.org/d3.v4.min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css"
  integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ=="
  crossorigin=""/>
  <script src="/RTStory/js/heatmap_data.js "></script>
  <script src="/RTStory/js/heatmap.min.js "></script>
  <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"
  integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log=="
  crossorigin=""></script>
  <script src="/RTStory/js/heatmap_overlay.js "></script>
  <script src="/RTStory/js/code2genre.js "></script>
  <script src="/RTStory/js/genre2code.js "></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.1/css/select2.css" rel="stylesheet"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.1/js/select2.js"></script>

  <!-- Custom Leo-->
  <script src="https://rawgit.com/jasondavies/d3-cloud/master/build/d3.layout.cloud.js"></script>
  <script src="https://unpkg.com/d3-simple-slider@0.2.0/build/d3-simple-slider.js"></script>
  <!--Custom Javascript end-->

  <!-- Custom Fonts -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
  <link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/RTStory/css/rrssb.css" />
  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
  
  <link rel="shortcut icon" type="image/x-icon" href="/RTStory/img/favicon.ico">
  

  

  


  <!-- iOS Web App mode -->

  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="apple-touch-icon" sizes="36x36" href="/RTStory/img/web-app/icon-36p.png">
  <link rel="apple-touch-icon" sizes="48x48" href="/RTStory/img/web-app/icon-48p.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/RTStory/img/web-app/icon-72p.png">
  <link rel="apple-touch-icon" sizes="96x96" href="/RTStory/img/web-app/icon-96p.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/RTStory/img/web-app/icon-144p.png">
  <link rel="apple-touch-icon" sizes="192x192" href="/RTStory/img/web-app/icon-192p.png">

  <!-- Android Web App mode -->

  <link rel="manifest" href="/RTStory/manifest.json">




  
<!-- Chrome, Firefox OS and Opera -->
<meta name="theme-color" content="#999999">
<!-- Windows Phone -->
<meta name="msapplication-navbutton-color" content="#999999">
<!-- iOS Safari -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="white">


  





  <!--momo parts start-->

<style>

  #map-container {
    margin: auto;
    height: 600px;
    width: 75%;
}

#vis {
    margin: auto;
    width: 50%;
    position: relative;
}

#play-button {
    position: absolute;
    /*top: 140px;*/
    top: 75px;
    left: -50px;
    background: #f08080;
    /*padding-right: 26px;*/
    /*border-radius: 3px;*/
    border: none;
    color: white;
    margin: 0;
    /*padding: 0 12px;*/
    width: 60px;
    cursor: pointer;
    height: 30px;
}

#play-button:hover {
    background-color: #696969;
}

.ticks {
    font-size: 10px;
}

.track,
.track-inset,
.track-overlay {
    stroke-linecap: round;
}

.track {
    stroke: #000;
    stroke-opacity: 0.3;
    stroke-width: 10px;
}

.track-inset {
    stroke: #dcdcdc;
    stroke-width: 8px;
}

.track-overlay {
    pointer-events: stroke;
    stroke-width: 50px;
    stroke: transparent;
    cursor: crosshair;
}

.handle {
    fill: #fff;
    stroke: #000;
    stroke-opacity: 0.5;
    stroke-width: 1.25px;
}

/* Drop-down list*/
* {
    box-sizing: border-box;
}

#fuzzSearch {
    width: 50%;
}

#fuzzNameContainer {
    height: 40px;
    padding: 4px 10px;
    border: 1px solid #999;
    box-shadow: inset 0 0 2px 0px #333;
    width: 100%;
    cursor: pointer;
    line-height: 1.9em;
}

.fuzzName {
    display: inline-block;
    width: 96%;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.fuzzArrow {
    width: 0;
    border-style: solid;
    border-color: #333 transparent transparent transparent;
    border-width: 7px;
    display: inline-block;
    cursor: pointer;
    position: relative;
    top: -3px;
    -webkit-transition: all 0.1s ease-in;
    transition: all 0.1s ease-in;
}

.fuzzArrow:hover {
    border-top-color: #888;
}

.fuzzArrow.fuzzArrowUp {
    border-color: transparent transparent #333 transparent;
    top: -11px;
}

#fuzzDropdownContainer {
    display: none;
    width: 100%;
    margin: 0 0 5px 0;
    border: 1px solid #999;
    padding: 12px 4px 4px;
    position: relative;
}

.fuzzMagicBox {
    width: 99%;
    height: 26px;
    margin: 0 auto;
}

.fuzzSearchIcon {
    width: 20px;
    height: 14px;
    position: relative;
    display: inline-block;
    background: transparent;
    top: -20px;
    left: 95%;
}

.fuzzSearchIcon:before,
.fuzzSearchIcon:after {
    content: '';
    display: block;
    position: absolute;
    right: 5px;
}

.fuzzSearchIcon:before {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    border: 1px solid #aaa;
}

.fuzzSearchIcon:after {
    height: 7px;
    border-right: 1px solid #aaa;
    top: 9px;
    -webkit-transform: rotate(-32deg);
    -ms-transform: rotate(-32deg);
}

#fuzzResults {
    cursor: pointer;
    padding: 0;
    margin: 0;
}

#fuzzResults li {
    list-style: none;
    margin-bottom: 10px;
    padding: 10px;
    transition: all 0.1s ease-out;
}

#fuzzResults li:hover,
#fuzzResults li.selected {
    color: #fff;
    background: #1251a4;
}

.highlight {
    color: red;
}
</style>





</head>

<!-- HEAD End -->


  <body id="page-top" data-spy="scroll" data-target=".navbar-fixed-top"  data-offset="151">

    
<!-- Navigation Start -->

<nav class="navbar navbar-custom navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-main-collapse">
        <i class="fa fa-bars"></i>
      </button>
      
        <a class="navbar-brand page-scroll" href="#page-top">
      
          <div>
            
              <img src="/RTStory/img/black-lab-glass.ico" alt="">
            
            { RTStory }
          </div>
        </a>
    </div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse navbar-right navbar-main-collapse">
      <ul class="nav navbar-nav">
        

          <!-- Scroll to section for each page in index -->
          
            <li>
              <a class="page-scroll" href="#about"> About </a>
            </li>
          
            <li>
              <a class="page-scroll" href="#themes"> Themes </a>
            </li>
          
            <li>
              <a class="page-scroll" href="#social"> Social Phenomenas </a>
            </li>
          
            <li>
              <a class="page-scroll" href="#gender"> Gender </a>
            </li>
          
            <li>
              <a class="page-scroll" href="#maps"> Maps </a>
            </li>
          
            <li>
              <a class="page-scroll" href="#contact"> Contact </a>
            </li>
          

        
      </ul>
    </div>
  </div>
</nav>

<!-- Navigation End -->


    
<!-- Intro Start -->

<header class="intro">
  <div class="intro-body">
    <div class="container">
      <div class="row">
          <div class="col-md-10 col-md-offset-1">
            <h1 class="brand-heading">&nbsp;</h1>
            <h1 class="brand-heading">&nbsp;</h1>
            <h5>&nbsp;</h5>
            <h3>An EPFL student's project</h3>
          </div>
        </div>
    </div>
  </div>
</header>

<!-- Intro End -->


    
      
        
      
        
          
<!-- About Start -->

<section id="about" class="container content-section text-center">
  <div class="row">
    <div class="col-md-10 col-md-offset-1">
      <h2 id="about-the-project">About the project</h2>

<p>In the frame of the Applied Data Analysis course of fall 2017 at EPFL.</p>

<p>The popular media is an (imperfect) mirror of the society. In this project, we want to study the effect of social trends and events of the 20th century on TV/Radio broadcasts. The 20th century saw the invention and ubiquity of the broadcast media: first radio and then television. Having access to a wealth of information about TV/Radio emissions all the way from 1930’s until today, we believe we can track these events and gain unique insights into the evolution of Swiss society.</p>

    </div>
  </div>
</section>

<!-- About End -->

        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
<!-- Themes Start -->

<section id="themes" class="container content-section text-center">
  <div class="row">
    <div class="col-md-10 col-md-offset-1">
      <h2 id="themes-over-the-years">Themes over the years</h2>

<p>To have an ensemble view on the topics of the programs, the number of occurencies of each word by year was added. The wordcloud below offers a nice way to visualize the evolution of different themes over the year. The dropdown on top of the cloud has four options : Genra, Topics, Persons and Locations. The slider at the bottom allows to pick a year between 1900 and 2017. There is way more data for the last decades and very little for the begining of the 20th century.</p>

<div id="container" style="background-color: #343434">
    <div id="top">
        <div id="drop">
            Choose the theme type or genra :
            <select id="themes_drop" style="background-color: black"></select>
        </div>
    </div>
    <div id="bottom">
        <div id="cloud_container" style="border:0px solid grey;margin: 25px;padding: 10px"></div>
        <div id="slider">
            <input type="range" list="tickmarks" min="1900" max="2017" value="1980" id="year" style="width: 90%; float: left;" />
            <span id="range_value" style="float: right;">1980</span>
            <datalist id="tickmarks">
            </datalist>
        </div>
        
    </div>
</div>
<p><br /></p>
<h3 id="word-war-ii">Word war II</h3>
<p>As expected, the main topic of the years between 1939 and 1945 is the world war II. What is interesting to observate is the evolution of the surrounding topics. In 1939 we can see the importance of national or war oriented words like “army”, “armed conflict”, “patriotism” or “international relatinships”.
<a href="#container" onclick="set_cloud(1939,'Topics');">Take me to 1939</a> Even in this context the second main topics are art related (history, litterature, dramatic art, writer). 
<a href="#container" onclick="set_cloud(1942,'Topics');">1942-43</a> we get “rationnement” and “recette culinaire”</p>

<p><a href="#container" onclick="set_cloud(1945,'Topics');">1945-46</a> peace is the second word</p>

<h3 id="rising-concerns-about-terrorism">Rising concerns about terrorism</h3>
<p><a href="#container" onclick="set_cloud(2013,'Persons');">2013</a> Matthieu Chedid new album “Îles” and internation tour.
<a href="#container" onclick="set_cloud(2014,'Persons');">2014</a> Group Etal Islamique, Etal Islamique
<a href="#container" onclick="set_cloud(2015,'Persons');">2015</a> Group Etal Islamique, Etal Islamique, Charlie Hebdo
<a href="#container" onclick="set_cloud(2015,'Topics');">2015 topics</a> Islam, terrorism</p>

<h3 id="why-bells-">Why bells ?</h3>
<p>From <a href="#container" onclick="set_cloud(1956,'Topics');">1956</a> to <a href="#container" onclick="set_cloud(1956,'Topics');">1960</a> the top topic is “cloche” which translate to “bell”. The term appears from nowhere and completly disapears the following years. Such results are hard to explain with only our history knowlegde so we dig into the data. As a matter of fact, there wasn’t much to explain, we found out that there was a radio program that lasted for three years that was about different church’s bells around Switerland. Other than that there was no further information. This example shows that even if topics like the World War II seem to have a meaning in term of word occurencies, sometimes it only means someone was motivated enough that he recorded the different soung of bells.</p>

    </div>
  </div>
</section>

<!-- Themes End -->

        
      
        
      
        
      
        
      
        
      
        
      
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
<!-- Gender Start -->

<section id="social" class="container content-section text-center">
  <div class="row">
    <div class="col-md-10 col-md-offset-1">
      <h2 id="major-social-phenomenas">Major social phenomenas</h2>
<p>This part was done by Sina.
How did the RTS coverage of important social phenomena like the sexual revolution, women’s voting right,
and terrorism evolved over time, using the number of occurences and co-occurences.</p>

<p><b>Note: Go over the bar plots to see appearing the co-occurenes for a given year.</b>
What we mean by co-occurece is : words that have appeared the most with the chosen topic for a given year.<br />
In some years, there is no dominant co-occurence (lower that the set threshold) so you don’t see any thing.</p>

<p>We have chosen to study some of the major social phenomenas of the 20th century. <br />
Looking at the various plots below, we can see some trends appearing :<br />
For women’s voting right, it peaks at 1971 when there was the election in Switzerland. Then it’s much less talked about, with some exceptions,
the last one being in 2017 and women’s voting right attributed to Saudi women.<br />
For Homosexuality, we can observe that there was absolutely nothing about the subject until 1960! It picks at 2003.
Observe that in the first apperences, the dominant co-occurences are films (movies), livre (books) showing that artists were trying to talk
about the project. Whereas in the last years, although the number of occurence has not changed (even decreased over last five years), but,
the dominant co-occurences are marriage, children and medicine showing the progress made on the subject.</p>

<p>Finally, for terrorisme, it’s interesting to see that after every pic, there is an important relax in the occurence, on the following year.
The co-occurence here gives nice insights about major terrorist attacks over the last 50 years. You can see, amongst others:<br />
Vietnam and US war in 1964<br />
l’affaire Gordji and Mitterand in 1988<br />
11 september attack (reflected in 2002)<br />
Madrid attacks in 2004<br />
Paris attacks in 2015</p>

<p><select id="favoriteThemes" name="form_select" style="background-color:black">
 <option value="terrorisme">Terrorism</option>
 <option value="vote">Women's voting right</option>
 <option value="famille">Famille</option>
 <option value="feminisme">Feminism</option>
 <option value="homosexualite">Homosexuality</option>
 <option value="mariage">Mariage</option>
</select></p>

<script type="text/javascript">
    document.getElementById('favoriteThemes').addEventListener('change', function () {
        $("#graph_container").children().hide();
        document.getElementById(this.value).style.display = "inline";
        //$("#"+this.value).show();
    });
</script>

<div id="graph_container">
    <iframe id="feminisme" width="900" height="800" frameborder="0" scrolling="no" style="display:none;" src="//plot.ly/~sfa/15.embed?link=false"></iframe>
    <iframe id="vote" width="900" height="800" frameborder="0" scrolling="no" style="display:none;" src="//plot.ly/~sfa/2.embed?link=false"></iframe>
    <iframe id="homosexualite" width="900" height="800" frameborder="0" scrolling="no" style="display:none;" src="//plot.ly/~sfa/6.embed?link=false"></iframe>
    <iframe id="terrorisme" width="900" height="800" frameborder="0" scrolling="no" style="display:inline;" src="//plot.ly/~sfa/17.embed?link=false"></iframe>
    <iframe id="famille" width="900" height="800" frameborder="0" scrolling="no" style="display:none;" src="//plot.ly/~sfa/9.embed?link=false"></iframe>
    <iframe id="mariage" width="900" height="800" frameborder="0" scrolling="no" style="display:none;" src="//plot.ly/~sfa/13.embed?link=false"></iframe>
</div>

    </div>
  </div>
</section>

<!-- Gender End -->

        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
      
        
      
        
      
        
      
        
      
        
          
<!-- Themes Start -->

<section id="gender" class="container content-section text-center">
  <div class="row">
    <div class="col-md-10 col-md-offset-1">
      <h2 id="gender-distribution">Gender distribution</h2>

<p>This part was done by Sina.
How has the distribution of genders for anchors and presenters evolved over the course of the years?<br />
Was there a gender bias? If yes, how is it changed?</p>

<p>There are over 100 different roles in the RTS dataset. Here we have selected to plot what we thought are the most interessting ones.
In general we can see various patterns.<br />
For ‘Interviewer’ and ‘Presenter’, we see a very nice progress over the last decades.
For some roles as ‘Producer’, there is not any progress and it stays a very masculine role.
There are roles where the gender equality was fair from earlier years. This is the case for ‘weather presenter’ role.<br /><br />
In general we can observe that the roles that have a direct contact with the audience (either audio or visual) have done very good
progress in term of gender representation over the past years and are now pretty close to equality (only in terms of number of male and female).
This can be seen for ‘weather presenter’, ‘Interviewer’ and ‘Presenter’ roles.<br />
On the other hand, some roles have not made any progress. One notable case in the ‘Interviewed’ case. This is the list of all
people (usually experts) that have been interviewed, on very various topics, by RTS. It gives a nice image of the society
(mostly at the elite level). We can see that there are still a lot of progress to be done…</p>

<p><select id="favoriteJob" name="form_select" style="background-color:black">
 <option value="1">Commentator</option>
 <option value="2">Presenter</option>
 <option value="4">Journalist</option>
 <option value="5">Producer</option>
 <option value="6">Interviewed</option>
 <option value="7">Director</option>
 <option value="8">Interviewer</option>
 <option value="9">Weather presenter</option>
 <option value="10">Various</option>
</select></p>

<script type="text/javascript">
    document.getElementById('favoriteJob').addEventListener('change', function () {
        $("#gender_graph_container").children().hide();
        document.getElementById(this.value).style.display = "inline";
        //$("#"+this.value).show();
    });
</script>

<div id="gender_graph_container">
    <iframe id="1" width="900" height="800" frameborder="0" scrolling="no" style="display:inline;" src="//plot.ly/~Jvj/18.embed?link=false"></iframe>
    <iframe id="2" width="900" height="800" frameborder="0" scrolling="no" style="display:none;" src="//plot.ly/~Jvj/16.embed?link=false"></iframe>
    <iframe id="4" width="900" height="800" frameborder="0" scrolling="no" style="display:none;" src="//plot.ly/~Jvj/12.embed?link=false"></iframe>
    <iframe id="5" width="900" height="800" frameborder="0" scrolling="no" style="display:none;" src="//plot.ly/~Jvj/10.embed?link=false"></iframe>
    <iframe id="6" width="900" height="800" frameborder="0" scrolling="no" style="display:none;" src="//plot.ly/~Jvj/8.embed?link=false"></iframe>
    <iframe id="7" width="900" height="800" frameborder="0" scrolling="no" style="display:none;" src="//plot.ly/~Jvj/6.embed?link=false"></iframe>
    <iframe id="8" width="900" height="800" frameborder="0" scrolling="no" style="display:none;" src="//plot.ly/~Jvj/4.embed?link=false"></iframe>
    <iframe id="9" width="900" height="800" frameborder="0" scrolling="no" style="display:none;" src="//plot.ly/~Jvj/2.embed?link=false"></iframe>
    <iframe id="10" width="900" height="800" frameborder="0" scrolling="no" style="display:none;" src="//plot.ly/~Jvj/0.embed?link=false"></iframe>
</div>

    </div>
  </div>
</section>

<!-- Themes End -->

        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
<!-- Maps Start -->

<section id="maps" class="container content-section text-center">
  <div class="row">
    <div class="col-md-10 col-md-offset-1">
      <h2 id="map">Map</h2>

<p>Geographica theme of programs</p>

<body>
    <div id="control-pane">
        <h2> Genres </h2>
        <select id="genresList" title="genres" multiple="multiple">
        </select>

    </div>

    <div id="map-container" style="width: 900px;"></div>

    <div id="vis">
        <button id="play-button">Play</button>
    </div>


    <script>

        var formatDateIntoYear = d3.timeFormat("%b %Y");
        var formatDate = d3.timeFormat("%b %Y");
    //    var parseDate = d3.timeParse("%m/%d/%y");
    var parseDate = d3.timeParse("%d/%m/%Y");

    var startDate = new Date("1930-01-01"),
    endDate = new Date("2017-12-01");


    var margin = {top: 50, right: 50, bottom: 0, left: 50},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

    var svg = d3.select("#vis")
    .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom);

    ////////// map ////////////

    var radius = 0.5,
    minOpacity = 0,
    maxOpacity = 0.5,
    scaleRadius = true,
    useLocalExtrema = true,
    lat = 46.79,
    lng = 8.20,
    zoom = 8;
    //            data = {
    //                max: 8,
    //                data: [{x: 24.6408, y: 46.7728, value: 3}, {x: 50.75, y: -1.55, data: 1}]
    //            };


    var cfg = {
        // radius should be small ONLY if scaleRadius is true (or small radius is intended)
        // if scaleRadius is false it will be the constant radius used in pixels
        "radius": radius,
        // "maxOpacity": .5,
        "minOpacity": minOpacity,
        "maxOpacity": maxOpacity,
        // scales the radius based on map zoom
        "scaleRadius": scaleRadius,
        // if set to false the heatmap uses the global maximum for colorization
        // if activated: uses the data maximum within the current map boundaries
        //   (there will always be a red spot with useLocalExtremas true)
        "useLocalExtrema": useLocalExtrema,
        // which field name in your data represents the latitude - default "lat"
        latField: 'x',
        // which field name in your data represents the longitude - default "lng"
        lngField: 'y',
        // which field name in your data represents the data value - default "value"
        valueField: 'valueField'
    };

    var heatmapLayer = new HeatmapOverlay(cfg);

    var tonerUrl = "http://{S}tile.stamen.com/toner/{Z}/{X}/{Y}.png";
    var url = tonerUrl.replace(/({[A-Z]})/g, function (s) {
        return s.toLowerCase();
    });

    var baseLayer = L.tileLayer(
        url, {
            subdomains: ['', 'a.', 'b.', 'c.', 'd.'],
            minZoom: 0,
            maxZoom: 20,
            type: 'png',
            attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, ' +
            'under <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>. ' +
            'Data by <a href="http://openstreetmap.org">OpenStreetMap</a>, under ' +
            '<a href="http://creativecommons.org/licenses/by-sa/3.0">CC BY SA</a>'
        }
        );

    var map = new L.Map("map-container", {
        center: new L.LatLng(lat, lng),
        zoom: zoom,
        layers: [baseLayer, heatmapLayer]
    });

    function leafletMap() {

        function my(selection) {
            // generate chart here, using `width` and `height`
            console.log("my called!")

            selection.each(function (d, i) {
                // generate chart here; `d` is the data and `this` is the element
                heatmapLayer.setData(d)
                console.log("set data:" + d) // TODO inja aslan nemire dadach!
            });


        }

        // Getter-Setter Methods for eanbaling syntax chaining

        my.width = function (value) {
            if (!arguments.length) return width;
            width = value;
            return my;
        };

        my.height = function (value) {
            if (!arguments.length) return height;
            height = value;
            return my;
        };

        my.radius = function (value) {
            if (!arguments.length) return radius;
            radius = value;
            return my;
        };

        my.minOpacity = function (value) {
            if (!arguments.length) return minOpacity;
            minOpacity = value;
            return my;
        };

        my.maxOpacity = function (value) {
            if (!arguments.length) return maxOpacity;
            maxOpacity = value;
            return my;
        };

        my.scaleRadius = function (value) {
            if (!arguments.length) return scaleRadius;
            scaleRadius = value;
            return my;
        };

        my.useLocalExtrema = function (value) {
            if (!arguments.length) return useLocalExtrema;
            useLocalExtrema = value;
            return my;
        };

        my.lat = function (value) {
            if (!arguments.length) return lat;
            lat = value;
            return my;
        };

        my.lng = function (value) {
            if (!arguments.length) return lng;
            lng = value;
            return my;
        };

        my.zoom = function (value) {
            if (!arguments.length) return zoom;
            zoom = value;
            return my;
        };

//        my.data = function (value) {
//            if (!arguments.length) return data;
//            data = value;
//            return my;
//        };

return my;
}

    ////////// slider //////////

    var moving = false;
    var currentValue = 0;
    var targetValue = width;

    var playButton = d3.select("#play-button");

    var x = d3.scaleTime()
    .domain([startDate, endDate])
    .range([0, targetValue])
    .clamp(true);

    var slider = svg.append("g")
    .attr("class", "slider")
    .attr("transform", "translate(" + margin.left + "," + height / 5 + ")");

    slider.append("line")
    .attr("class", "track")
    .attr("x1", x.range()[0])
    .attr("x2", x.range()[1])
    .select(function () {
        return this.parentNode.appendChild(this.cloneNode(true));
    })
    .attr("class", "track-inset")
    .select(function () {
        return this.parentNode.appendChild(this.cloneNode(true));
    })
    .attr("class", "track-overlay")
    .call(d3.drag()
        .on("start.interrupt", function () {
            slider.interrupt();
        })
        .on("start drag", function () {
            currentValue = d3.event.x;
            update(x.invert(currentValue));
        })
        );

    slider.insert("g", ".track-overlay")
    .attr("class", "ticks")
    .attr("transform", "translate(0," + 18 + ")")
    .selectAll("text")
    .data(x.ticks(10))
    .enter()
    .append("text")
    .attr("x", x)
    .attr("y", 10)
    .attr("text-anchor", "middle")
    .text(function (d) {
        return formatDateIntoYear(d);
    });

    var handle = slider.insert("circle", ".track-overlay")
    .attr("class", "handle")
    .attr("r", 9);

    var label = slider.append("text")
    .attr("class", "label")
    .attr("text-anchor", "middle")
    .text(formatDate(startDate))
    .attr("transform", "translate(0," + (-25) + ")")


    ////////// plot //////////

    var dataset;
    var filtered_data;

    var plot = svg.append("g")
    .attr("class", "plot")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    //    function loadData(start, len) {
    //        var points = heatmap_data.slice(start, start + len);
    function loadData(points) {
        var len = points.length;
        var newpoints = [];
        var max = 0;
        // var width = 840;
        // var height = 400;
        while (len--) {
            var val = points[len];
            max = Math.max(max, val);
            var point = {x: val.x, y: val.y, value: val.value};
            newpoints.push(point);
        }
        var data = {max: max, data: newpoints};
        myloadedData = data;
        return data;
    }


    function selectedOption() {
        log.console("Selected Option!")
    }

    function setOptions() {


    }

    var available_genres;

    function calcAvailableOptions() {
        let all_genres_options = [];
        for (r = 0; r < filtered_data.length; r++) {
            for (i = 0; i < filtered_data[r].genre.length; i++) {
                all_genres_options.push(filtered_data[r].genre[i]);
            }
        }
        available_genres = Array.from(new Set(all_genres_options))
    }


    d3.csv("heatmap_date_freq_coord_genre.csv", prepare, function (data) {
        dataset = data;
        filtered_data = data;
        calcAvailableOptions();

        // Adding (Filtering) Options

        d3.select('body')
        //            .select('#control-pane')
        .select('#genresList')
            //            .append('div')
            //            .append('select')
            //              .on('change',change)
            //              .on('change', selectedOption)
            .selectAll('option')
            //              .on('change', selectedOption)
            .append("option")
            .data(available_genres)
            .enter()
            .append('option')
            .attr('value', function (d, i) {
                return i
            })
            .text(function (d) {
                return d
            });

            $(document).ready(function() {
                $('#genresList').select2();

                $('#genresList').on('select2:select', function (e) {
                    var data = e.params.data;
                    console.log(data);
                    console.log("Current Selection:");
                    console.log($('#genresList').select2('data'));
                });
            });

//        d3.select('body')
//            .select('#fuzzSearch')
//            //            .select("#fuzzName")
//            .on('change', selectedOption);


//        $('#fuzzOptionsList').fuzzyDropdown({
//            mainContainer: '#fuzzSearch',
//            arrowUpClass: 'fuzzArrowUp',
//            selectedClass: 'selected',
//            enableBrowserDefaultScroll: true
//        });


drawPlot(dataset);

d3.select("#map-container")
.datum(data)
.call(leafletMap);


playButton
.on("click", function () {
    var button = d3.select(this);
    if (button.text() == "Pause") {
        moving = false;
        clearInterval(timer);
                    // timer = 0;
                    button.text("Play");
                } else {
                    moving = true;
                    timer = setInterval(step, 100);
                    button.text("Pause");
                }
                console.log("Slider moving: " + moving);
            })
});

    function buildMap(obj) {
        let map = new Map();
        Object.keys(obj).forEach(key => {
            map.set(parseInt(key), obj[key]);
        });
        return map;
    }

    function prepare(d) {
        d.id = parseInt(d.id);
        d.date = parseDate(d.date);
        d.value = parseInt(d.value);
        d.x = parseFloat(d.x);
        d.y = parseFloat(d.y);
        d.genre_code = JSON.parse(d.genre_code);
        d.genre = [];
        for (i = 0; i < d.genre_code.length; i++) {
            d.genre.push(code2genre[d.genre_code[i]]);
        }
        return d;
    }

    function step() {
        update(x.invert(currentValue));
        currentValue = currentValue + (targetValue / 151);
        if (currentValue > targetValue) {
            moving = false;
            currentValue = 0;
            clearInterval(timer);
            // timer = 0;
            playButton.text("Play");
            console.log("Slider moving: " + moving);
        }
    }

    var myMap = leafletMap();
    //        .x(function(d) { return formatDate.parse(d.date); })
    //        .y(function(d) { return +d.price; });

    //    var formatDate = d3.time.format("%b %Y");

    var count = 0

    function drawPlot(data) {
        console.log(data.length)
        console.log("draw is called!")
        var locations = plot.select("#map-container")
        .datum(data)
        .call(myMap);

//        heatmapLayer.setData(loadData(count, 300));
heatmapLayer.setData(loadData(data));
//        count+=300;

//        console.log(locations)

//        // if filtered dataset has more circles than already existing, transition new ones in
//        locations.enter().call(leafletMap);
//            .append("circle")
//            .attr("class", "location")
//            .attr("cx", function (d) {
//                return x(d.date);
//            })
//            .attr("cy", height / 2)
//            .style("fill", function (d) {
//                return d3.hsl(d.date / 1000000000, 0.8, 0.8)
//            })
//            .style("stroke", function (d) {
//                return d3.hsl(d.date / 1000000000, 0.7, 0.7)
//            })
//            .style("opacity", 0.5)
//            .attr("r", 8)
//            .transition()
//            .duration(400)
//            .attr("r", 25)
//            .transition()
//            .attr("r", 8);

        // if filtered dataset has less circles than already existing, remove excess
//        locations.exit()
//            .remove();
}

function update(h) {
    console.log(h);
//        console.log(typeof h);
console.log(d3.timeDay.offset(h, 1));
        // update position and text of label according to slider scale
        handle.attr("cx", x(h));
        label
        .attr("x", x(h))
        .text(formatDate(h));

        // filter data set and redraw plot
        var newData = dataset.filter(function (d) {
            return (d.date > h) && (d.date <= d3.timeDay.offset(h, 5));
        });
        drawPlot(newData);
//        drawPlot(dataset);
//        console.log(dataset.length)
}

</script>
</body>

    </div>
  </div>
</section>

<!-- Maps End -->

        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
      
        
      
        
      
        
          
<!-- Contact Start -->

<section id="contact" class="container content-section text-center">
  <div class="row">
    <div class="col-md-10 col-md-offset-1">

      <h2 id="contact">Contact</h2>

<p>Project done by Mohammad Yaghini, Sina Fakheri and Leonardo Wirz</p>


      
        
          
            <p>
            <script>
              function join_at_email(user, domain){
              return (user && domain)?(user + "@" + domain):"";
              }
              document.write('<a href="mailto:'
              + join_at_email( "leonardo.wirz", "epfl.ch" )
              + '">'
              + join_at_email( "leonardo.wirz", "epfl.ch" )
              + '</a>'
              );
              </script>
            </p>
        
      

    </div>
  </div>
</section>

<!-- Contact End -->

        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    <!-- Footer Start -->

<footer>

    <!-- Social Buttons Start -->

<ul class="list-inline social-buttons">
    
    
</ul>

<!-- Social Buttons End -->


    <p><br><br></p>

    <div class="container text-center">
        <p>Copyright &copy; Mohammad Yaghini, Sina Fakheri and Leonardo Wirz 2017</p>
        
    </div>
</footer>

<p><br><br><br><br><br><br></p>

<!-- Footer End -->


    
<!-- Javascript Start -->

<!-- Start the wordcloud -->
<script src="/RTStory/js/wordcloud.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

<!-- Plugin JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>

<!-- Custom Theme JavaScript -->
<!--* Start Bootstrap - Grayscale Bootstrap Theme (http://startbootstrap.com)
* Code licensed under the Apache License v2.0.
* For details, see http://www.apache.org/licenses/LICENSE-2.0.-->
<script>
function toggleNavCollapse(){50<$(".navbar").offset().top?$(".navbar-fixed-top").addClass("top-nav-collapse"):$(".navbar-fixed-top").removeClass("top-nav-collapse");}
$(document).ready(toggleNavCollapse);
$(window).scroll(toggleNavCollapse);$(function(){$("a.page-scroll").bind("click",function(b){var a=$(this);$("html, body").stop().animate({scrollTop:$(a.attr("href")).offset().top-50},1500,"easeInOutExpo",function(){a.blur()});b.preventDefault()})});$(".navbar-collapse ul li a").click(function(){$(".navbar-toggle:visible").click()});
</script>



  <!-- Collapse navbar when navbar-brand is clicked -->

  <script>
  $(function(){$(".navbar-brand").click(function(){$(".collapse.in")&&$(".collapse.in").animate({height:"1px"},500,function(){$(".collapse.in").removeClass("in")})})});
  </script>













  <!-- Dynamic Typing Start -->

  <script type="text/javascript" src="/RTStory/js/typed.min.js"></script>
  <script type="text/javascript">

  var myQuotes =  new Array();
  

  function shuffle(array) {
    var currentIndex = array.length, temporaryValue, randomIndex ;

    // While there remain elements to shuffle...
    while (0 !== currentIndex) {

      // Pick a remaining element...
      randomIndex = Math.floor(Math.random() * currentIndex);
      currentIndex -= 1;

      // And swap it with the current element.
      temporaryValue = array[currentIndex];
      array[currentIndex] = array[randomIndex];
      array[randomIndex] = temporaryValue;
    }

    return array;
  }

  
    shuffle(myQuotes)
  

    $(".intro-text").typed({
      strings: myQuotes,
      typeSpeed: 10,
      backDelay: 5000,
      startDelay: 200,
      loop: true,
      loopCount: false,
      cursorChar: "|"
    });
  </script>

  <!-- Dynamic Typing End  -->



<script>
function addTohistory() {
  if (!window.location.host.startsWith("127.0.0.1")) {
    history.pushState({}, '', 'http://localhost:4000/RTStory/');
  }
}
</script>

<!-- Gesture Navigation / Swipe Instruction Start -->


  

  

  

  

<!-- Gesture Navigation / Swipe Instruction End -->



<!-- Javascript End -->


  </body>
</html>

<!-- Index Layout End -->
